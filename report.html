<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>SMARTWORK – บันทึกข้อความ</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap"
      rel="stylesheet"
    />

    <style>
      body {
        font-family: "TH Sarabun New", "Sarabun", sans-serif;
        background: #e9e9e9;
        padding: 20px;
      }
      .page {
        width: 794px;
        min-height: 1123px;
        background: white;
        margin: auto;
        padding: 40px 50px;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.25);
      }
      h2 {
        text-align: center;
        margin-top: 0;
      }
      .meta {
        font-size: 18px;
        margin-bottom: 4px;
      }
      .section-title {
        font-size: 20px;
        font-weight: bold;
        margin-top: 20px;
      }
      .detail {
        font-size: 18px;
        white-space: pre-wrap;
      }
      .img-row {
        margin-top: 15px;
        display: flex;
        gap: 10px;
        flex-wrap: wrap;
      }
      .img-row img {
        width: 240px;
        height: 160px;
        object-fit: cover;
        border-radius: 6px;
        border: 1px solid #999;
      }
      .btn-row {
        max-width: 794px;
        margin: 15px auto;
        display: flex;
        justify-content: flex-end;
        gap: 10px;
      }
      button {
        padding: 8px 14px;
        font-size: 18px;
        border-radius: 8px;
        border: none;
        cursor: pointer;
      }
      .btn-print {
        background: #1e4bb8;
        color: white;
      }
      .btn-back {
        background: #444;
        color: white;
      }
    </style>
  </head>

  <body>
    <div class="page" id="pageArea">
      <h2>บันทึกข้อความ (รายงานผลการปฏิบัติงาน)</h2>
      <div id="meta"></div>

      <div class="section-title">รายละเอียดกิจกรรม</div>
      <div id="detail" class="detail"></div>

      <div class="section-title">ตัวชี้วัด</div>
      <div id="indicator" class="detail"></div>

      <div class="section-title">หลักฐานภาพถ่ายกิจกรรม</div>
      <div id="imgRow" class="img-row"></div>
    </div>

    <div class="btn-row">
      <button class="btn-print" onclick="window.print()">พิมพ์</button>
      <button class="btn-back" onclick="location.href='index.html'">
        กลับหน้ารายการ
      </button>
    </div>

    <script>
      function thaiDate(d) {
        if (!d) return "-";
        const dt = new Date(d);
        const m = [
          "มกราคม",
          "กุมภาพันธ์",
          "มีนาคม",
          "เมษายน",
          "พฤษภาคม",
          "มิถุนายน",
          "กรกฎาคม",
          "สิงหาคม",
          "กันยายน",
          "ตุลาคม",
          "พฤศจิกายน",
          "ธันวาคม",
        ];
        return `${dt.getDate()} ${m[dt.getMonth()]} ${dt.getFullYear() + 543}`;
      }

      let item = null;

      if (localStorage.getItem("REPORT_ITEM")) {
        item = JSON.parse(localStorage.getItem("REPORT_ITEM"));
      } else if (localStorage.getItem("LATEST_WORK")) {
        item = JSON.parse(localStorage.getItem("LATEST_WORK"));
      }

      if (!item) {
        document.getElementById("pageArea").innerHTML =
          "<h3>ยังไม่มีข้อมูล กรุณาบันทึกงานก่อน</h3>";
      } else {
        document.getElementById("meta").innerHTML = `
          <div class="meta"><strong>ผู้รายงาน:</strong> ${item.name}</div>
          <div class="meta"><strong>ตำแหน่ง:</strong> ${item.pos}</div>
          <div class="meta"><strong>สังกัด:</strong> ${item.unit}</div>
          <div class="meta"><strong>วันที่ดำเนินงาน:</strong> ${thaiDate(
            item.workDate
          )}</div>
          <div class="meta"><strong>ชื่องาน:</strong> ${item.title}</div>
        `;

        detail.textContent = item.detail || "-";
        indicator.textContent = item.indicator || "-";

        const pics = item.pics || [];
        const row = document.getElementById("imgRow");
        pics.slice(0, 2).forEach((p) => {
          const img = document.createElement("img");
          img.src = p;
          row.appendChild(img);
        });
      }
    </script>
  </body>
</html>
