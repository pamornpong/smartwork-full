<!DOCTYPE html>
<html lang="th">
  <head>
    <meta charset="UTF-8" />
    <title>SMARTWORK ‚Äì ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î</title>

    <link
      href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

    <!-- ‡πÇ‡∏´‡∏•‡∏î SCRIPT_URL ‡∏à‡∏≤‡∏Å config.js -->
    <script src="config.js"></script>

    <style>
      body {
        font-family: "TH Sarabun New", "Sarabun", sans-serif;
        background: #f0f2f5;
        margin: 0;
        padding: 15px;
      }
      .topbar {
        max-width: 1100px;
        margin: auto;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .profile {
        display: flex;
        align-items: center;
        gap: 10px;
      }
      .profile img {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        border: 2px solid #ccc;
      }
      .profile-info {
        font-size: 16px;
      }
      .title-block h2 {
        margin: 0;
        font-size: 28px;
        text-align: right;
      }
      .title-block .note {
        font-size: 15px;
        color: #555;
        text-align: right;
      }
      .filter-bar {
        max-width: 1100px;
        margin: 15px auto 5px auto;
        display: grid;
        grid-template-columns: 1.6fr 1.2fr 1.2fr;
        gap: 10px;
      }
      .filter-bar input,
      .filter-bar select {
        padding: 6px 8px;
        font-size: 18px;
        border-radius: 8px;
        border: 1px solid #bbb;
      }
      .suggest-box {
        max-width: 1100px;
        margin: 0 auto 5px auto;
        font-size: 16px;
      }
      .suggest-item {
        display: inline-block;
        background: #e9f2ff;
        padding: 2px 6px;
        margin-right: 4px;
        border-radius: 6px;
        cursor: pointer;
        margin-bottom: 4px;
      }
      .grid {
        max-width: 1100px;
        margin: 10px auto 0 auto;
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(260px, 1fr));
        gap: 16px;
      }
      .card {
        background: #fff;
        border-radius: 12px;
        padding: 12px;
        box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
        cursor: pointer;
        transition: 0.2s;
      }
      .card:hover {
        transform: scale(1.02);
      }
      .thumb {
        width: 100%;
        height: 150px;
        object-fit: cover;
        border-radius: 10px;
      }
      footer {
        max-width: 1100px;
        margin: 10px auto 0 auto;
        text-align: right;
        font-size: 14px;
        color: #777;
      }
    </style>
  </head>

  <body>
    <div class="topbar">
      <div class="profile">
        <img id="avatarProfile" src="https://via.placeholder.com/60x60?text=Avatar" />
        <div class="profile-info" id="profileInfo"></div>
      </div>
      <div class="title-block">
        <h2>‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î (SMARTWORK)</h2>
        <div class="note">‡∏î‡∏∂‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Google Sheet ‡∏ú‡πà‡∏≤‡∏ô Google Apps Script</div>
      </div>
    </div>

    <div class="filter-bar">
      <input
        type="text"
        id="searchInput"
        placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤‡∏à‡∏≤‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°/‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î/‡∏•‡∏¥‡∏á‡∏Å‡πå..."
      />
      <select id="indicatorFilter">
        <option value="">‚Äî ‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ‚Äî</option>
        <option value="1)">1) ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏ï‡∏≤‡∏°‡∏´‡∏•‡∏±‡∏Å‡∏™‡∏π‡∏ï‡∏£</option>
        <option value="2)">2) ‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏™‡∏ô‡∏±‡∏ö‡∏™‡∏ô‡∏∏‡∏ô‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ</option>
        <option value="3)">3) ‡∏ô‡∏¥‡πÄ‡∏ó‡∏® ‡∏Å‡∏≥‡∏Å‡∏±‡∏ö ‡∏ï‡∏¥‡∏î‡∏ï‡∏≤‡∏°</option>
        <option value="4)">4) ‡∏õ‡∏è‡∏¥‡∏ö‡∏±‡∏ï‡∏¥‡∏á‡∏≤‡∏ô‡∏≠‡∏∑‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏ó‡∏µ‡πà‡πÑ‡∏î‡πâ‡∏£‡∏±‡∏ö‡∏°‡∏≠‡∏ö‡∏´‡∏°‡∏≤‡∏¢</option>
      </select>
      <button
        onclick="location.href='form.html'"
        style="
          font-size: 18px;
          border-radius: 8px;
          border: none;
          background: #0a7b34;
          color: #fff;
          cursor: pointer;
        "
      >
        + ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏ú‡∏•‡∏á‡∏≤‡∏ô‡πÉ‡∏´‡∏°‡πà
      </button>
    </div>

    <div class="suggest-box" id="suggestBox"></div>

    <div id="grid" class="grid"></div>

    <footer>SMARTWORK ‚Äì Personal Portfolio & Report System</footer>

    <script>
      /* üî• ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏ó‡∏µ‡πà‡∏™‡∏∏‡∏î  
         index.html ‡∏à‡∏∞‡πÉ‡∏ä‡πâ SCRIPT_URL ‡∏à‡∏≤‡∏Å config.js */
      console.log("SCRIPT_URL =", SCRIPT_URL);

      const cfg = JSON.parse(localStorage.getItem("SMARTWORK_CONFIG") || "{}");

      // ‡πÅ‡∏™‡∏î‡∏á‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå
      profileInfo.innerHTML =
        "<strong>" +
        (cfg.fullname || "-") +
        "</strong><br>" +
        (cfg.position || "") +
        "<br>‡∏™‡∏Å‡∏£.‡∏≠." +
        (cfg.district || "") +
        " ‡∏™‡∏≥‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏™‡πà‡∏á‡πÄ‡∏™‡∏£‡∏¥‡∏°‡∏Å‡∏≤‡∏£‡πÄ‡∏£‡∏µ‡∏¢‡∏ô‡∏£‡∏π‡πâ‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏à‡∏±‡∏á‡∏´‡∏ß‡∏±‡∏î‡∏®‡∏£‡∏µ‡∏™‡∏∞‡πÄ‡∏Å‡∏©";

      if (cfg.avatarDataUrl) avatarProfile.src = cfg.avatarDataUrl;

      let allData = [];
      let filteredData = [];
      let currentPage = 1;
      const PER_PAGE = 9;

      // ‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏à‡∏≤‡∏Å Apps Script
      async function loadData() {
        try {
          const res = await fetch(SCRIPT_URL);
          const data = await res.json();

          console.log("DATA =", data); // debug ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç‡∏™‡∏∏‡∏î

          allData = data;
          filteredData = allData.slice();
          render();
        } catch (e) {
          Swal.fire("‡∏ú‡∏¥‡∏î‡∏û‡∏•‡∏≤‡∏î", "‡πÇ‡∏´‡∏•‡∏î‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à", "error");
        }
      }

      function render() {
        const grid = document.getElementById("grid");
        grid.innerHTML = "";

        const start = (currentPage - 1) * PER_PAGE;
        const items = filteredData.slice(start, start + PER_PAGE);

        items.forEach((item) => {
          const img =
            item.pics && item.pics.length
              ? item.pics[0]
              : "https://via.placeholder.com/350x200?text=No+Image";

          grid.innerHTML += `
            <div class="card" onclick='openModal(${JSON.stringify(
              item
            ).replace(/"/g, "&quot;")})'>
              <img src="${img}" class="thumb">
              <div class="title">${item.title || "-"}</div>
              <div class="meta">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà: ${item.workDate || "-"}</div>
              <div class="meta">‡∏ï‡∏±‡∏ß‡∏ä‡∏µ‡πâ‡∏ß‡∏±‡∏î: ${item.indicator || "-"}</div>
            </div>`;
        });
      }

      loadData();
    </script>
  </body>
</html>
